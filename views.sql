-- View for all games and the corresponding statistics, where two players were in the same game
CREATE OR REPLACE VIEW public.common_game_stats
 AS
 SELECT sm1.gameid,
    sm1.accountid,
    p.teamid,
    p.championid,
    p.spell1id,
    p.spell2id,
    s.statid,
    s.win,
    s.items,
    s.kills,
    s.deaths,
    s.assists,
    s.largestkillingspree,
    s.largestmultikill,
    s.killingsprees,
    s.longesttimespentliving,
    s.doublekills,
    s.triplekills,
    s.quadrakills,
    s.pentakills,
    s.unrealkills,
    s.totaldamagedealt,
    s.magicdamagedealt,
    s.physicaldamagedealt,
    s.truedamagedealt,
    s.largestcriticalstrike,
    s.totaldamagedealttochampions,
    s.magicdamagedealttochampions,
    s.physicaldamagedealttochampions,
    s.truedamagedealttochampions,
    s.totalheal,
    s.totalunitshealed,
    s.damageselfmitigated,
    s.damagedealttoobjectives,
    s.damagedealttoturrets,
    s.visionscore,
    s.timeccingothers,
    s.totaldamagetaken,
    s.magicdamagetaken,
    s.physicaldamagetaken,
    s.truedamagetaken,
    s.goldearned,
    s.goldspent,
    s.turretkills,
    s.inhibitorkills,
    s.totalminionskilled,
    s.neutralminionskilledteamjungle,
    s.neutralminionskilledenemyjungle,
    s.totaltimecrowdcontroldealt,
    s.champlevel,
    s.visionwardsboughtingame,
    s.sightwardsboughtingame,
    s.wardsplaced,
    s.wardskilled,
    s.firstbloodkill,
    s.firstbloodassist,
    s.firsttowerkill,
    s.firsttowerassist,
    s.firstinhibitorkill,
    s.firstinhibitorassit,
    s.combatplayerscore,
    s.objectiveplayerscore,
    s.totalplayerscore,
    s.totalscorerank,
    s.playerscore0,
    s.playerscore1,
    s.playerscore2,
    s.playerscore3,
    s.playerscore4,
    s.playerscore5,
    s.playerscore6,
    s.playerscore7,
    s.playerscore8,
    s.playerscore9,
    s.perk0,
    s.perk0var1,
    s.perk0var2,
    s.perk0var3,
    s.perk1,
    s.perk1var1,
    s.perk1var2,
    s.perk1var3,
    s.perk2,
    s.perk2var1,
    s.perk2var2,
    s.perk2var3,
    s.perk3,
    s.perk3var1,
    s.perk3var2,
    s.perk3var3,
    s.perk4,
    s.perk4var1,
    s.perk4var2,
    s.perk4var3,
    s.perk5,
    s.perk5var1,
    s.perk5var2,
    s.perk5var3,
    s.perkprimarystyle,
    s.perksubstyle,
    s.statperk0,
    s.statperk1,
    s.statperk2
   FROM ((((summoner_matches sm1
     JOIN summoner_matches sm2 ON (((sm1.gameid = sm2.gameid) AND ((sm1.accountid)::text <> (sm2.accountid)::text))))
     JOIN matches m ON ((sm1.gameid = m.gameid)))
     JOIN participants p ON ((((p.participantid)::text = ANY ((m.participants)::text[])) AND ((sm1.accountid)::text = (p.accountid)::text))))
     JOIN stats s ON (((p.statid)::text = (s.statid)::text)));